# 第6章 核心探秘1【面试宝典】

## 1.请你描述一下小程序端都有哪些功能？

扫码、附近售货机与地图导航、商品列表、下单支付、我的订单查询。

## 2.订单表如何设计的?

立可得的订单表与电商系统的订单表不同，只有一个表。因为智能售货机每次只卖出一个商品，所以是不需要订单明细表的。主要的字段有订单id、订单编号、openId、支付方式、订单状态、支付状态、售货机编号、商品id、商品名称、金额、区域、点位、商圈等。

## 3.小程序如何获取当前用户的唯一标识？

唯一标识是openId  ,  后端提供接口，可以根据前端传递过来的jsCode 调用openId工具类返回openId, 工具类里封装了对微信平台的远程调用，最后返给前端。

## 4.支付是如何实现的？

在系统中，架构师为我们封装了支付工具类，具体使用就是在配置文件中配置appid,商户id,密钥，回调地址等信息。下单需要传递一个封装好的dto对象，有四个属性:  订单号、商品名称、金额、openid。这个下单的方法会返回一个xml格式的结果，我们将这个结果返给前端。前端拿到这个结果，会唤起手机中的微信支付模块，弹出支付窗口。当用户支付成功后，微信支付平台会回调你的回调地址。你在回调的方法中对输入流进行解析，判断是否支付成功，如果支付成功，则执行修改订单状态、发货等动作。

## 5.小程序如何测试？

在开发阶段，可以使用微信开发者工具进行测试。微信开发者工具要求使用者用微信登录，在微信开发者平台中需要将该使用者加为开发者，或者使用测试号进行测试。但是如果小程序有支付功能，使用测试号是无法测试支付的。

## 6.订单超时如何处理？

（1）定时任务

（2）延迟队列

## 7.你用过哪个内网穿透工具，如何使用？

cpolar  。下载，注册账号，获取token，执行 cpolar http  本地端口  ，使用临时域名即可访问。 

## 8.延迟消息在项目中的应用场景。

超时未支付订单的处理。



