# 第2章 架构梳理【面试宝典】

## 1.你在项目中主要使用了JDK11的哪些新特性？

1.增强局部变量类型推断var  ，让书写更加简洁

2.增加了许多字符串自带方法  

3.自带了这个 HTTP Client API

4.完全支持Linux容器(包括Docker)

## 2.描述一下项目的工程架构。（几个微服务、网关、公共模块）

微服务：用户微服务、工单微服务、订单微服务、售货机微服务，微信小程序微服务

网关：微信用户端-微信小程序网关（C端），是B端网关，用于管理后台、合作商后台、运营APP。

公共模块：  通用公共模块，用于存放通用工具类等。 还有微服务公共模块，用于微服务公用的VO类、DTO类、消息协议类、feign接口等。

## 3.如何实现微服务的跨服务调用？

同步调用：通过feign来进行微服务间的调用。

异步调用：通过消息中间件（EMQ）来进行调用。

我们在项目中，除了跨服务查询采用feign调用外，大多数都采用异步方式，性能很好。

## 4.什么是雪崩？ 如何防止雪崩？

在微服务架构中调用关系比较复杂，比如A调用B ，B调用C ，那么如果C出现问题芭比Q了，会倒是B调用C得不到响应，最终因为资源耗尽也芭比Q了，最终导致整个系统芭比Q了。这就是我们所说的雪崩。

防止雪崩的方法：我们对所有进行微服务调用的feign接口都定义了一个对应的fallbackFactory，来进行请求熔断，当feign接口无法调用时就会返回熔断器的返回值。

## 5.实体之间如何建立关联关系？

比如点位和区域是多对一关系，我们就会在点位实体类上定义一个区域的实体类属性，并在加上注解@TableField(exist = false)  ，然后修改实体类的@TableName注解部分  ，指定 resultMap。  在数据访问接口中用@Results 注解定义resultMap。



## 6.mybatisPlus有哪些功能可以简化你的开发？

Mybatis-Plus（简称MP）是一个 Mybatis 的增强工具，在 Mybatis 的基础上只做增强不做改变，为简化开发、提高效率而生。具体体现在：

（1）dao继承BaseMapper 接口，基本增删改查无需编写。

（2）service继承IService 接口，impl继承serviceImpl，  基本增删改查无需编写。 

（3）自动填充功能可以简化代码，例如每个表都有创建时间和修改时间，就是自动生成的。

（4）提供了逻辑删除，数据隔离等功能。

（5）提供了代码生成器。

## 7.说一说你项目中的登录如何实现的？

B端的登录有三个登录入口，分别是管理员登录管理后台，合作商登录合作商后台，运营和运维人员登录APP。

管理员登录管理后台采用用户名+密码+图形验证码方式，运营和运维人员登录APP采用手机号+短信验证码方式，合作商采用手机号+密码+图形验证码方式。图形验证码采用Kaptcha，短信采用springCloudAlibabaSMS 短信服务。

## 8.网关鉴权如何实现？

我们采用的是JWT方式的网关鉴权。这是当前最主流的一种方式。当用户登录成功后，后端会返回JWT的token , 前端拿到这个token可以暂时保存起来，（比如可以使用localStorage）。再次请求后端地址时，就携带这个token。在网关有过滤器对这个token 进行JWT 校验，如果校验成功，提取出用户id，传给后边的微服务，如果校验不成功，则拦截返回401   .

## 9. 你用什么工具进行接口测试 ？

一些临时测试用postman，更主要是用VScode的restClient插件来测试，因为它是采用脚本方式的，使用起来特别方便。

## 10.小程序如何获取用户唯一标识？

前端(小程序)是可以获取一个叫 jsCode 的字符串 ，前端把jsCode发给后端，后端请求微信小程序接口可以根据jsCode 返回openID  ，后端拿到openID 后再返给前端。openID 是当前小程序的当前用户的唯一标识 。
